<!DOCTYPE html>
<html>
<head>
	<title>Test</title>
	<script type="text/javascript">

		

		function llamada(){
			var miVariable = "Tijeretazo en Italia:  eliminan 230 diputados y 115 senadores";

			var textPage = "Nos habéis preguntado por un contenido que dice que la crisis del coronavirus rebaja en Italia el número de políticos y, también, por otro que dice que recortan el gasto político y eliminan 230 diputados y 115 senadores en Italia en plena crisis del coronavirus. Es un bulo: las dos páginas web se hacen eco de una noticia publicada por La Razón en octubre de 2019 y el contenido que mueven está descontextualizado. ESPECIAL CORONAVIRUS:  Consúltalo aquí. La noticia de La Razón, cuyo título es Tijeretazo en Italia: se eliminan 230 diputados y 115 senadores, se publicó el pasado 8 de octubre de 2019. Todos los partidos aprobaron la ley que recorta en un tercio el número de diputados y senadores de cara a la próxima legislatura por lo que la Cámara de Diputados pasara de tener 630 escaños a 400, explican desde este medio. Es decir, la medida para reducir el número de parlamentarios italianos no se ha aprobado en plena crisis del coronavirus ni por la crisis del coronavirus. Sin embargo, la ley aprobada el pasado 8 de octubre, no entró inmediatamente en vigor, sino que era preciso que durante los próximos tres meses después de su publicación en la Gaceta Oficial se convocase un referéndum para confirmarla. En Italia, estaba previsto que este referéndum constitucional se celebrara el 29 de marzo. Pero la crisis del coronavirus ha provocado que se prorrogue. Por el momento, el primer ministro italiano, Giuseppe Conte, todavía no ha dado una nueva fecha para la votación. Por lo tanto, no es cierto que la crisis del coronavirus rebaja en Italia el número de políticos ni tampoco que recortan el gasto político y eliminan 230 diputados y 115 senadores en Italia en plena crisis del coronavirus porque son contenidos que se mueven de manera descontextualizada.";

			readText(textPage,miVariable);
		}

		function readText(text,keywords) {

			var completeKeywInText = searchCompleteText(text,keywords);
			var numberText = 0;
			var percent = 0;
			var keys = 0;
			var badKeys = 0;
			var textSplited = 0;
			var count = 0;


			if (completeKeywInText === 0) {
				//cambiamos a minúsculas todo el texto
				keywords = keywords.toLowerCase();
				text = text.toLowerCase();


				//extraemos los carácteres innecesarios
				keys = keywords.split(/[-+, .]/);

				//eliminamos elementos duplicados en el array
				keys = keys.filter(onlyUnique);

				badKeys = ["de","el","la","lo","le","en","que","a","e","y","o","u","ha","se","del"];

				for( var i = 0; i < keys.length; i++){ 
					for( var j = 0; j < badKeys.length; j++){
						if ( keys[i] === badKeys[j]) 
						{ 
							keys.splice(i, 1); 
						}
					}
				}

				textSplited = text.split(/[-+, .]/);

				//cantidad de palabras que coinciden
				for (var i = 0; i < textSplited.length; i++) {
					for (var j = 0; j < keys.length; j++){
						if (keys[j] == textSplited[i] && keys[j] != "") {
							count++;
						}
					}
				}

				numberText = textSplited.length;
				percent = (count * 100) / numberText;

				
			}


			// Determinamos la escala del bulo
			if (percent < 3) {
				console.log("No es bulo");
			}
			else if (percent >= 3 && percent <= 5){
				console.log("Posible bulo");
			}
			else if (percent > 5) {
				console.log("Es bulo.");
			}

			if (completeKeywInText === 1) {
				console.log("el título existe en la descripción de forma exacta, por lo que se considera bulo.");
			}

			console.log("------Información de las variables--------");
			console.log("Coincidencias en keywords: "+count);
			console.log("Porcentaje de coincidencias: "+percent+"%");
			console.log(keys);
			console.log(textSplited);
		}

		// Función para extraer elementos duplicados
		function onlyUnique(value, index, self) { 
		    return self.indexOf(value) === index;
		}


		// Función para buscar el título completo en el texto.
		function searchCompleteText(text,keywords){
			var result;

			text = text.toLowerCase();
			keywords = keywords.toLowerCase();

			if (text.includes(keywords) == true) {
				result = 1;

			}
			else{
				result = 0;
			}
			return result;

		}
	</script>
</head>
<body>
	<h1>Pangolines</h1>
	<button onclick="llamada();">Probar</button>
</body>
</html>