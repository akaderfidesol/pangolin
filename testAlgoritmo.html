<!DOCTYPE html>
<html>
<head>
	<title>Test</title>
	<script type="text/javascript">
		
		var openFile = function(event) {
	        var input = event.target;

	        var reader = new FileReader();
	        reader.onload = function(){
	          	var noticia = reader.result;
	          
	          	//console.log(text);

	          	var titulo = "Se dispararon perfiles falsos entre los seguidores de Pedro Sánchez en Twitter";
				readText(noticia,titulo);

	        };
	        reader.readAsText(input.files[0]);
	    };

		/*function llamada(){
			var miVariable = "China amplía las restricciones en sus nuevos focos de infección";

			readTextFile("noticia.txt");

			var textPage = "";

			readText(textPage,miVariable);
		}*/

		function readText(text,keywords) {

			var completeKeywInText = searchCompleteText(text,keywords);
			var textLength = 0;
			var percent = 0;
			var keys = 0;
			var badKeys = 0;
			var textSplited = 0;
			var matchWords = 0;


			if (completeKeywInText === 0) {
				//cambiamos a minúsculas todo el texto
				keywords = keywords.toLowerCase();
				text = text.toLowerCase();


				//extraemos los carácteres innecesarios
				keys = keywords.split(/[-+, .]/);

				//eliminamos elementos duplicados en el array
				keys = keys.filter(onlyUnique);

				badKeys = ["de","el","la","lo","le","en","que","a","e","y","o","u","ha","se","del"];

				for( var i = 0; i < keys.length; i++){ 
					for( var j = 0; j < badKeys.length; j++){
						if ( keys[i] === badKeys[j]) 
						{ 
							keys.splice(i, 1); 
						}
					}
				}

				textSplited = text.split(/[-+, .]/);

				//cantidad de palabras que coinciden
				for (var i = 0; i < textSplited.length; i++) {
					for (var j = 0; j < keys.length; j++){
						if (keys[j] == textSplited[i] && keys[j] != "") {
							matchWords++;
						}
					}
				}

				textLength = textSplited.length;
				percent = (matchWords * 100) / textLength;

				
			}


			// Determinamos la escala del bulo
			if (percent < 3) {
				console.log("No es bulo");
			}
			else if (percent >= 3 && percent <= 5){
				console.log("Posible bulo");
			}
			else if (percent > 5) {
				console.log("Es bulo.");
			}

			if (completeKeywInText === 1) {
				console.log("el título existe en la descripción de forma exacta, por lo que se considera bulo.");
			}

			console.log("------Información de las variables--------");
			console.log("Coincidencias en keywords: "+matchWords);
			console.log("Porcentaje de coincidencias: "+percent+"%");
			console.log(keys);
			console.log(textSplited);
		}

		// Función para extraer elementos duplicados
		function onlyUnique(value, index, self) { 
		    return self.indexOf(value) === index;
		}


		// Función para buscar el título completo en el texto.
		function searchCompleteText(text,keywords){
			var result;

			text = text.toLowerCase();
			keywords = keywords.toLowerCase();

			if (text.includes(keywords) == true) {
				result = 1;

			}
			else{
				result = 0;
			}
			return result;

		}
	</script>
</head>
<body>
	<h1>Pangolin</h1>
	<input type='file' accept='text/plain' onchange='openFile(event)'><br>
    <div id='output'>
	<button onclick="llamada();">Probar</button>
</body>
</html>